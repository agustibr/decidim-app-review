{"ast":null,"code":"import UploadModal from \"src/decidim/direct_uploads/upload_modal\";\nimport { truncateFilename, createHiddenInput } from \"src/decidim/direct_uploads/upload_utility\";\n\nvar loadAttachments = function loadAttachments(modal) {\n  Array.from(modal.activeAttachments.children).forEach(function (child) {\n    modal.createUploadItem(child.dataset.filename, child.dataset.title, \"validated\");\n  });\n};\n\nvar addInputEventListener = function addInputEventListener(modal) {\n  modal.input.addEventListener(\"change\", function (event) {\n    event.preventDefault();\n    var files = event.target.files;\n    Array.from(files).forEach(function (file) {\n      return modal.uploadFile(file);\n    });\n  });\n};\n\nvar addButtonEventListener = function addButtonEventListener(modal) {\n  modal.button.addEventListener(\"click\", function (event) {\n    event.preventDefault();\n    Array.from(modal.trashCan.children).forEach(function (item) {\n      modal.uploadItems.append(item);\n    });\n\n    if (modal.uploadItems.children.length === 0) {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.addlabel;\n    } else {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.editlabel;\n    }\n\n    modal.updateDropZone();\n  });\n};\n\nvar addDropZoneEventListeners = function addDropZoneEventListeners(modal) {\n  modal.dropZone.addEventListener(\"dragenter\", function (event) {\n    event.preventDefault();\n  });\n  modal.dropZone.addEventListener(\"dragover\", function (event) {\n    event.preventDefault();\n    modal.dropZone.classList.add(\"is-dragover\");\n  });\n  modal.dropZone.addEventListener(\"dragleave\", function () {\n    modal.dropZone.classList.remove(\"is-dragover\");\n  });\n  modal.dropZone.addEventListener(\"drop\", function (event) {\n    event.preventDefault();\n    var files = event.dataTransfer.files;\n    Array.from(files).forEach(function (file) {\n      return modal.uploadFile(file);\n    });\n  });\n};\n\nvar addSaveButtonEventListener = function addSaveButtonEventListener(modal) {\n  modal.saveButton.addEventListener(\"click\", function (event) {\n    event.preventDefault();\n    var validatedItems = modal.uploadItems.querySelectorAll(\".upload-item[data-state='validated']\");\n    var validatedItemsCount = validatedItems.length;\n    validatedItems.forEach(function (item) {\n      var details = item.querySelector(\".attachment-details\");\n\n      if (details) {\n        modal.activeAttachments.appendChild(details);\n      } else {\n        details = modal.activeAttachments.querySelector(\".attachment-details[data-filename='\".concat(item.dataset.filename, \"'\"));\n      }\n\n      var span = details.querySelector(\"span\");\n      span.classList.add(\"filename\");\n\n      if (modal.options.titled) {\n        var title = item.querySelector(\"input[type='text']\").value;\n        details.dataset.title = title;\n        var hiddenTitle = details.querySelector(\".hidden-title\");\n\n        if (hiddenTitle) {\n          hiddenTitle.value = title;\n        } else {\n          var attachmentId = details.querySelector(\"[name='\".concat(modal.options.resourceName, \"[\").concat(modal.name, \"][]'\")).value;\n          var ordinalNumber = modal.getOrdinalNumber();\n          var hiddenTitleField = createHiddenInput(\"hidden-title\", \"\".concat(modal.options.resourceName, \"[\").concat(modal.options.addAttribute, \"][\").concat(ordinalNumber, \"][title]\"), title);\n          var hiddenIdField = createHiddenInput(\"hidden-id\", \"\".concat(modal.options.resourceName, \"[\").concat(modal.options.addAttribute, \"][\").concat(ordinalNumber, \"][id]\"), attachmentId);\n          details.appendChild(hiddenTitleField);\n          details.appendChild(hiddenIdField);\n        }\n\n        span.innerHTML = \"\".concat(title, \" (\").concat(truncateFilename(item.dataset.filename), \")\");\n      } else {\n        span.innerHTML = truncateFilename(item.dataset.filename, 19);\n      }\n\n      span.style.display = \"block\";\n    });\n\n    if (!modal.options.titled && modal.trashCan.children.length > 0) {\n      modal.activeAttachments.innerHTML = \"<input name='\".concat(modal.options.resourceName, \"[remove_\").concat(modal.name, \"]' type=\\\"hidden\\\" value=\\\"true\\\">\");\n    }\n\n    if (validatedItemsCount > 0) {\n      // Foundation helper does some magic with error fields, so these must be triggered using jQuery.\n      var $el = $(modal.uploadContainer.querySelector(\"input[type='checkbox']\"));\n\n      if ($el) {\n        $el.prop(\"checked\", true);\n        $el.trigger(\"change\");\n      }\n    }\n\n    modal.cleanTrashCan();\n    modal.updateAddAttachmentsButton();\n  });\n};\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  var attachmentButtons = document.querySelectorAll(\"button.add-file\");\n  attachmentButtons.forEach(function (attachmentButton) {\n    var modal = new UploadModal(attachmentButton);\n    loadAttachments(modal);\n    addInputEventListener(modal);\n    addButtonEventListener(modal);\n    addDropZoneEventListeners(modal);\n    addSaveButtonEventListener(modal);\n  });\n});","map":{"version":3,"mappings":"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","names":["UploadModal","truncateFilename","createHiddenInput","loadAttachments","modal","Array","from","activeAttachments","children","forEach","child","createUploadItem","dataset","filename","title","addInputEventListener","input","addEventListener","event","preventDefault","files","target","file","uploadFile","addButtonEventListener","button","trashCan","item","uploadItems","append","length","modalTitle","innerHTML","addlabel","editlabel","updateDropZone","addDropZoneEventListeners","dropZone","classList","add","remove","dataTransfer","addSaveButtonEventListener","saveButton","validatedItems","querySelectorAll","validatedItemsCount","details","querySelector","appendChild","span","options","titled","value","hiddenTitle","attachmentId","resourceName","name","ordinalNumber","getOrdinalNumber","hiddenTitleField","addAttribute","hiddenIdField","style","display","$el","$","uploadContainer","prop","trigger","cleanTrashCan","updateAddAttachmentsButton","document","attachmentButtons","attachmentButton"],"sources":["/home/agustibr/.asdf/installs/ruby/3.0.2/lib/ruby/gems/3.0.0/bundler/gems/decidim-a25b5c74f78d/decidim-core/app/packs/src/decidim/direct_uploads/upload_field.js"],"sourcesContent":["import UploadModal from \"src/decidim/direct_uploads/upload_modal\";\nimport { truncateFilename, createHiddenInput } from \"src/decidim/direct_uploads/upload_utility\";\n\nconst loadAttachments = (modal) => {\n  Array.from(modal.activeAttachments.children).forEach((child) => {\n    modal.createUploadItem(child.dataset.filename, child.dataset.title, \"validated\");\n  })\n}\n\nconst addInputEventListener = (modal) => {\n  modal.input.addEventListener(\"change\", (event) => {\n    event.preventDefault();\n    const files = event.target.files;\n    Array.from(files).forEach((file) => modal.uploadFile(file));\n  })\n}\n\nconst addButtonEventListener = (modal) => {\n  modal.button.addEventListener(\"click\", (event) => {\n    event.preventDefault();\n    Array.from(modal.trashCan.children).forEach((item) => {\n      modal.uploadItems.append(item);\n    })\n    if (modal.uploadItems.children.length === 0) {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.addlabel;\n    } else {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.editlabel;\n    }\n    modal.updateDropZone();\n  })\n}\n\nconst addDropZoneEventListeners = (modal) => {\n  modal.dropZone.addEventListener(\"dragenter\", (event) => {\n    event.preventDefault();\n  })\n\n  modal.dropZone.addEventListener(\"dragover\", (event) => {\n    event.preventDefault();\n    modal.dropZone.classList.add(\"is-dragover\");\n  })\n\n  modal.dropZone.addEventListener(\"dragleave\", () => {\n    modal.dropZone.classList.remove(\"is-dragover\");\n  })\n\n  modal.dropZone.addEventListener(\"drop\", (event) => {\n    event.preventDefault();\n    const files = event.dataTransfer.files;\n    Array.from(files).forEach((file) => modal.uploadFile(file));\n  })\n}\n\nconst addSaveButtonEventListener = (modal) => {\n  modal.saveButton.addEventListener(\"click\", (event) => {\n    event.preventDefault();\n    const validatedItems = modal.uploadItems.querySelectorAll(\".upload-item[data-state='validated']\")\n    const validatedItemsCount = validatedItems.length;\n    validatedItems.forEach((item) => {\n      let details = item.querySelector(\".attachment-details\");\n      if (details) {\n        modal.activeAttachments.appendChild(details);\n      } else {\n        details = modal.activeAttachments.querySelector(`.attachment-details[data-filename='${item.dataset.filename}'`);\n      }\n      const span = details.querySelector(\"span\");\n      span.classList.add(\"filename\");\n      if (modal.options.titled) {\n        const title = item.querySelector(\"input[type='text']\").value;\n        details.dataset.title = title;\n        let hiddenTitle = details.querySelector(\".hidden-title\")\n        if (hiddenTitle) {\n          hiddenTitle.value = title;\n        } else {\n          const attachmentId = details.querySelector(`[name='${modal.options.resourceName}[${modal.name}][]'`).value\n          const ordinalNumber = modal.getOrdinalNumber()\n          const hiddenTitleField = createHiddenInput(\"hidden-title\", `${modal.options.resourceName}[${modal.options.addAttribute}][${ordinalNumber}][title]`, title)\n          const hiddenIdField = createHiddenInput(\"hidden-id\", `${modal.options.resourceName}[${modal.options.addAttribute}][${ordinalNumber}][id]`, attachmentId)\n          details.appendChild(hiddenTitleField);\n          details.appendChild(hiddenIdField);\n        }\n        span.innerHTML = `${title} (${truncateFilename(item.dataset.filename)})`;\n      } else {\n        span.innerHTML = truncateFilename(item.dataset.filename, 19);\n      }\n      span.style.display = \"block\";\n    });\n\n    if (!modal.options.titled && modal.trashCan.children.length > 0) {\n      modal.activeAttachments.innerHTML = `<input name='${modal.options.resourceName}[remove_${modal.name}]' type=\"hidden\" value=\"true\">`;\n    }\n\n    if (validatedItemsCount > 0) {\n      // Foundation helper does some magic with error fields, so these must be triggered using jQuery.\n      const $el = $(modal.uploadContainer.querySelector(\"input[type='checkbox']\"));\n      if ($el) {\n        $el.prop(\"checked\", true);\n        $el.trigger(\"change\");\n      }\n    }\n    modal.cleanTrashCan();\n    modal.updateAddAttachmentsButton();\n  });\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const attachmentButtons = document.querySelectorAll(\"button.add-file\");\n\n  attachmentButtons.forEach((attachmentButton) => {\n    const modal = new UploadModal(attachmentButton);\n    loadAttachments(modal);\n    addInputEventListener(modal);\n    addButtonEventListener(modal);\n    addDropZoneEventListeners(modal);\n    addSaveButtonEventListener(modal);\n  })\n})\n"]},"metadata":{},"sourceType":"module"}