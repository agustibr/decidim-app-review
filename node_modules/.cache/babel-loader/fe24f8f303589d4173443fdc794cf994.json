{"ast":null,"code":"/* eslint-disable require-jsdoc, id-length, no-undefined, no-unused-vars, multiline-ternary, no-ternary, no-nested-ternary, no-invalid-this */\n\n/* eslint prefer-reflect: [\"error\", { \"exceptions\": [\"call\"] }] */\n\n/* eslint dot-location: [\"error\", \"property\"] */\n\n/* eslint no-unused-vars: 0 */\nimport { select, mouse } from \"d3-selection\";\nimport { min, max, extent, ascending, bisector } from \"d3-array\";\nimport { scaleTime, scaleLinear } from \"d3-scale\";\nimport { axisLeft, axisBottom } from \"d3-axis\";\nimport { timeMonth } from \"d3-time\";\nimport { timeFormat, isoParse } from \"d3-time-format\";\nimport { area, line } from \"d3-shape\"; // lib\n\nexport default function areachart() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  var parseData = function parseData(data) {\n    // format the data\n    data.forEach(function (d) {\n      d.key = isoParse(d.key);\n      d.value = Number(d.value);\n    }); // order by date\n\n    return data.sort(function (x, y) {\n      return ascending(x.key, y.key);\n    });\n  }; // OPTIONAL: Helper function to accumulates all data values\n\n\n  var aggregate = function aggregate(agg) {\n    return agg.map(function (item, index, array) {\n      if (index > 0) {\n        item.value += array[index - 1].value;\n      }\n\n      return item;\n    });\n  }; // parse opts\n\n\n  var data = parseData(opts.data);\n  var title = opts.title;\n  var objectName = opts.objectName || \"\";\n  var container = select(opts.container);\n  var showAxis = opts.axis || false;\n  var ratio = (opts.ratio || \"\").split(\":\").reduce(function (a, b) {\n    return a / b;\n  }) || 4 / 3;\n  var showTooltip = Object.is(opts.tip, undefined) ? true : opts.tip;\n  var cumulative = opts.agg || false;\n\n  if (cumulative) {\n    data = aggregate(data);\n  } // set the dimensions and margins of the graph\n\n\n  var margin = {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n  var width = Number(container.node().getBoundingClientRect().width) - margin.left - margin.right;\n  var height = width / ratio - margin.top - margin.bottom;\n  var titlePadding = min([width / 10, 32]); // set the ranges\n\n  var x = scaleTime().range([0, width]);\n  var y = scaleLinear().range([height, 0]); // define the area\n\n  var _area = area().x(function (d) {\n    return x(d.key);\n  }).y0(height).y1(function (d) {\n    return y(d.value);\n  }); // define the line\n\n\n  var valueline = line().x(function (d) {\n    return x(d.key);\n  }).y(function (d) {\n    return y(d.value);\n  });\n  var svg = container.append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", \"translate(\".concat(margin.left, \",\").concat(margin.top, \")\")); // scale the range of the data\n\n  x.domain(extent(data, function (d) {\n    return d.key;\n  }));\n  y.domain([0, max(data, function (d) {\n    return d.value;\n  })]).nice(); // add the valueline path.\n\n  var topLine = svg.append(\"path\").data([data]).attr(\"class\", \"line\").attr(\"d\", valueline); // add the area\n\n  svg.append(\"path\").data([data]).attr(\"class\", \"area\").attr(\"d\", _area);\n\n  if (showTooltip) {\n    // tooltip\n    var circle = svg.append(\"circle\").attr(\"class\", \"circle\").attr(\"r\", 6).style(\"display\", \"none\");\n    var tooltip = select(\"body\").append(\"div\").attr(\"id\", \"\".concat(container.node().id, \"-tooltip\")).attr(\"class\", \"chart-tooltip\").style(\"opacity\", 0);\n    svg.on(\"mouseover\", function () {\n      circle.style(\"display\", null);\n      tooltip.style(\"opacity\", 1);\n    }).on(\"mouseout\", function () {\n      circle.style(\"display\", \"none\");\n      tooltip.style(\"opacity\", 0);\n    }).on(\"mousemove\", function () {\n      var x0 = x.invert(mouse(this)[0]);\n      var i = bisector(function (d) {\n        return d.key;\n      }).left(data, x0, 1);\n      var d0 = data[i - 1];\n      var d1 = data[i];\n      var d = x0 - d0.key > d1.key - x0 ? d1 : d0; // svg position relative to document\n\n      var coords = {\n        x: window.pageXOffset + container.node().getBoundingClientRect().left,\n        y: window.pageYOffset + container.node().getBoundingClientRect().top\n      };\n      var tooltipContent = \"\\n          <div class=\\\"tooltip-content\\\">\\n            \".concat(timeFormat(\"%e %B %Y\")(d.key), \"<br />\\n            \").concat(d.value.toLocaleString(), \" \").concat(objectName, \"\\n          </div>\");\n      circle.attr(\"transform\", \"translate(\".concat(x(d.key), \",\").concat(y(d.value), \")\"));\n      tooltip.html(tooltipContent).style(\"left\", \"\".concat(coords.x + x(d.key), \"px\")).style(\"top\", \"\".concat(coords.y + y(d.value), \"px\"));\n    });\n  }\n\n  if (showAxis) {\n    var xAxis = axisBottom(x).ticks(timeMonth).tickFormat(timeFormat(\"%b %y\")).tickSize(-height);\n    var yAxis = axisLeft(y).ticks(5).tickSize(8);\n\n    var _xAxis = function _xAxis(g) {\n      g.call(xAxis);\n      g.select(\".domain\").remove();\n      g.selectAll(\".tick line\").attr(\"class\", \"dashed\");\n      g.selectAll(\".tick text\").attr(\"y\", 6);\n    };\n\n    var _yAxis = function _yAxis(g) {\n      g.call(yAxis);\n      g.select(\".domain\").remove();\n      g.select(\".tick:first-of-type\").remove();\n      g.selectAll(\".tick text\").attr(\"text-anchor\", \"start\").attr(\"x\", 6);\n    }; // custom X-Axis\n\n\n    svg.append(\"g\").attr(\"transform\", \"translate(0,\".concat(height, \")\")).call(_xAxis); // custom Y-Axis\n\n    svg.append(\"g\").call(_yAxis); // last circle (current value)\n\n    var g = svg.append(\"g\").data([data]).attr(\"transform\", function (d) {\n      return \"translate(\".concat(x(d[d.length - 1].key), \",\").concat(y(d[d.length - 1].value), \")\");\n    });\n    g.append(\"circle\").attr(\"class\", \"circle\").attr(\"r\", 8);\n    g.append(\"text\").attr(\"class\", \"sum\").attr(\"text-anchor\", \"end\").attr(\"dx\", -8 * 2).text(function (d) {\n      return d[d.length - 1].value.toLocaleString();\n    });\n  } else {\n    // add the title group\n    var _g = svg.append(\"g\").attr(\"text-anchor\", \"start\").attr(\"transform\", \"translate(\".concat(titlePadding, \",\").concat(titlePadding, \")\"));\n\n    var titleLines = 0;\n\n    if (title.length) {\n      _g.append(\"text\").attr(\"x\", 0).attr(\"y\", 0).attr(\"class\", \"title\").text(title).call(function (fulltext, wrapwidth) {\n        var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n        fulltext.each(function () {\n          var text = select(this);\n          var word = \"\";\n          var words = text.text().split(/\\s+/).reverse();\n          var _line = [];\n          var lineNumber = 0;\n          var lineHeight = 1.1;\n\n          var _x = text.attr(\"x\");\n\n          var _y = text.attr(\"y\");\n\n          var dy = 0;\n          var tspan = text.text(null).append(\"tspan\").attr(\"x\", _x).attr(\"y\", _y).attr(\"dy\", \"\".concat(dy, \"em\"));\n          /* eslint-disable no-cond-assign, no-plusplus */\n\n          while (word = words.pop()) {\n            _line.push(word);\n\n            tspan.text(_line.join(\" \"));\n\n            if (tspan.node().getComputedTextLength() > wrapwidth) {\n              _line.pop();\n\n              tspan.text(_line.join(\" \"));\n              _line = [word];\n              tspan = text.append(\"tspan\").attr(\"x\", _x).attr(\"y\", _y).attr(\"dy\", \"\".concat(++lineNumber * lineHeight + dy, \"em\")).text(word);\n            }\n          }\n\n          titleLines = lineNumber * lineHeight;\n        });\n      }, width - titlePadding * 2);\n    }\n\n    var fontSize = parseFloat(getComputedStyle(_g.node()).fontSize);\n\n    _g.append(\"text\").attr(\"x\", 0).attr(\"dy\", title.length ? titlePadding * 2 + titleLines * fontSize : titlePadding * 1.25).attr(\"class\", \"sum\").text(data[data.length - 1].value.toLocaleString());\n  }\n}","map":{"version":3,"mappings":"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","names":["select","mouse","min","max","extent","ascending","bisector","scaleTime","scaleLinear","axisLeft","axisBottom","timeMonth","timeFormat","isoParse","area","line","areachart","opts","parseData","data","forEach","d","key","value","Number","sort","x","y","aggregate","agg","map","item","index","array","title","objectName","container","showAxis","axis","ratio","split","reduce","a","b","showTooltip","Object","is","tip","undefined","cumulative","margin","top","right","bottom","left","width","node","getBoundingClientRect","height","titlePadding","range","_area","y0","y1","valueline","svg","append","attr","domain","nice","topLine","circle","style","tooltip","id","on","x0","invert","i","d0","d1","coords","window","pageXOffset","pageYOffset","tooltipContent","toLocaleString","html","xAxis","ticks","tickFormat","tickSize","yAxis","_xAxis","g","call","remove","selectAll","_yAxis","length","text","titleLines","fulltext","wrapwidth","start","each","word","words","reverse","_line","lineNumber","lineHeight","_x","_y","dy","tspan","pop","push","join","getComputedTextLength","fontSize","parseFloat","getComputedStyle"],"sources":["/home/agustibr/.asdf/installs/ruby/3.0.2/lib/ruby/gems/3.0.0/bundler/gems/decidim-a25b5c74f78d/decidim-core/app/packs/src/decidim/vizzs/areachart.js"],"sourcesContent":["/* eslint-disable require-jsdoc, id-length, no-undefined, no-unused-vars, multiline-ternary, no-ternary, no-nested-ternary, no-invalid-this */\n/* eslint prefer-reflect: [\"error\", { \"exceptions\": [\"call\"] }] */\n/* eslint dot-location: [\"error\", \"property\"] */\n/* eslint no-unused-vars: 0 */\n\nimport { select, mouse } from \"d3-selection\";\nimport { min, max, extent, ascending, bisector } from \"d3-array\";\nimport { scaleTime, scaleLinear } from \"d3-scale\";\nimport { axisLeft, axisBottom } from \"d3-axis\";\nimport { timeMonth } from \"d3-time\";\nimport { timeFormat, isoParse } from \"d3-time-format\";\nimport { area, line } from \"d3-shape\";\n\n// lib\nexport default function areachart(opts = {}) {\n\n  const parseData = (data) => {\n    // format the data\n    data.forEach((d) => {\n      d.key = isoParse(d.key)\n      d.value = Number(d.value)\n    });\n\n    // order by date\n    return data.sort((x, y) => ascending(x.key, y.key))\n  }\n\n  // OPTIONAL: Helper function to accumulates all data values\n  const aggregate = (agg) => agg.map((item, index, array) => {\n    if (index > 0) {\n      item.value += array[index - 1].value\n    }\n    return item\n  })\n\n  // parse opts\n  let data = parseData(opts.data)\n  let title = opts.title\n  let objectName = opts.objectName || \"\"\n  let container = select(opts.container)\n  let showAxis = opts.axis || false\n  let ratio = (opts.ratio || \"\").split(\":\").reduce((a, b) => a / b) || (4 / 3)\n  let showTooltip = Object.is(opts.tip, undefined) ? true : opts.tip\n  let cumulative = opts.agg || false\n\n  if (cumulative) {\n    data = aggregate(data)\n  }\n\n  // set the dimensions and margins of the graph\n  let margin = {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  }\n\n  let width = Number(container.node().getBoundingClientRect().width) - margin.left - margin.right\n  let height = (width / ratio) - margin.top - margin.bottom\n  let titlePadding = min([width / 10, 32])\n\n  // set the ranges\n  let x = scaleTime().range([0, width]);\n  let y = scaleLinear().range([height, 0]);\n\n  // define the area\n  let _area = area()\n    .x((d) => x(d.key))\n    .y0(height)\n    .y1((d) => y(d.value));\n\n  // define the line\n  let valueline = line()\n    .x((d) => x(d.key))\n    .y((d) => y(d.value));\n\n  let svg = container.append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`);\n\n  // scale the range of the data\n  x.domain(extent(data, (d) => d.key));\n  y.domain([0, max(data, (d) => d.value)]).nice();\n\n  // add the valueline path.\n  let topLine = svg.append(\"path\")\n    .data([data])\n    .attr(\"class\", \"line\")\n    .attr(\"d\", valueline)\n\n  // add the area\n  svg.append(\"path\")\n    .data([data])\n    .attr(\"class\", \"area\")\n    .attr(\"d\", _area)\n\n  if (showTooltip) {\n    // tooltip\n    let circle = svg.append(\"circle\")\n      .attr(\"class\", \"circle\")\n      .attr(\"r\", 6)\n      .style(\"display\", \"none\")\n\n    let tooltip = select(\"body\").append(\"div\")\n      .attr(\"id\", `${container.node().id}-tooltip`)\n      .attr(\"class\", \"chart-tooltip\")\n      .style(\"opacity\", 0)\n\n    svg\n      .on(\"mouseover\", () => {\n        circle.style(\"display\", null)\n        tooltip.style(\"opacity\", 1)\n      })\n      .on(\"mouseout\", () => {\n        circle.style(\"display\", \"none\")\n        tooltip.style(\"opacity\", 0)\n      })\n      .on(\"mousemove\", function() {\n        let x0 = x.invert(mouse(this)[0])\n        let i = bisector((d) => d.key).left(data, x0, 1)\n        let d0 = data[i - 1]\n        let d1 = data[i]\n        let d = (x0 - d0.key > d1.key - x0) ? d1 : d0\n\n        // svg position relative to document\n        let coords = {\n          x: window.pageXOffset + container.node().getBoundingClientRect().left,\n          y: window.pageYOffset + container.node().getBoundingClientRect().top\n        }\n\n        let tooltipContent = `\n          <div class=\"tooltip-content\">\n            ${timeFormat(\"%e %B %Y\")(d.key)}<br />\n            ${d.value.toLocaleString()} ${objectName}\n          </div>`\n\n        circle.attr(\"transform\", `translate(${x(d.key)},${y(d.value)})`)\n        tooltip.html(tooltipContent)\n          .style(\"left\", `${coords.x + x(d.key)}px`)\n          .style(\"top\", `${coords.y + y(d.value)}px`)\n      })\n  }\n\n  if (showAxis) {\n    let xAxis = axisBottom(x)\n      .ticks(timeMonth)\n      .tickFormat(timeFormat(\"%b %y\"))\n      .tickSize(-height)\n    let yAxis = axisLeft(y)\n      .ticks(5)\n      .tickSize(8)\n\n    let _xAxis = (g) => {\n      g.call(xAxis)\n      g.select(\".domain\").remove()\n      g.selectAll(\".tick line\").attr(\"class\", \"dashed\")\n      g.selectAll(\".tick text\").attr(\"y\", 6)\n    }\n    let _yAxis = (g) => {\n      g.call(yAxis)\n      g.select(\".domain\").remove()\n      g.select(\".tick:first-of-type\").remove()\n      g.selectAll(\".tick text\").attr(\"text-anchor\", \"start\").attr(\"x\", 6)\n    }\n\n    // custom X-Axis\n    svg.append(\"g\")\n      .attr(\"transform\", `translate(0,${height})`)\n      .call(_xAxis);\n\n    // custom Y-Axis\n    svg.append(\"g\")\n      .call(_yAxis)\n\n    // last circle (current value)\n    let g = svg.append(\"g\")\n      .data([data])\n      .attr(\"transform\", (d) => `translate(${x(d[d.length - 1].key)},${y(d[d.length - 1].value)})`)\n\n    g.append(\"circle\")\n      .attr(\"class\", \"circle\")\n      .attr(\"r\", 8)\n\n    g.append(\"text\")\n      .attr(\"class\", \"sum\")\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"dx\", -8 * 2)\n      .text((d) => d[d.length - 1].value.toLocaleString())\n\n  } else {\n    // add the title group\n    let g = svg.append(\"g\")\n      .attr(\"text-anchor\", \"start\")\n      .attr(\"transform\", `translate(${titlePadding},${titlePadding})`)\n\n    let titleLines = 0\n\n    if (title.length) {\n      g.append(\"text\")\n        .attr(\"x\", 0)\n        .attr(\"y\", 0)\n        .attr(\"class\", \"title\")\n        .text(title)\n        .call(function(fulltext, wrapwidth, start = 0) {\n          fulltext.each(function() {\n            let text = select(this)\n            let word = \"\"\n            let words = text.text().split(/\\s+/).reverse()\n            let _line = []\n            let lineNumber = 0\n            let lineHeight = 1.1\n            let _x = text.attr(\"x\")\n            let _y = text.attr(\"y\")\n            let dy = 0\n            let tspan = text.text(null)\n              .append(\"tspan\")\n              .attr(\"x\", _x)\n              .attr(\"y\", _y)\n              .attr(\"dy\", `${dy}em`)\n\n            /* eslint-disable no-cond-assign, no-plusplus */\n            while (word = words.pop()) {\n              _line.push(word);\n              tspan.text(_line.join(\" \"));\n              if (tspan.node().getComputedTextLength() > wrapwidth) {\n                _line.pop()\n                tspan.text(_line.join(\" \"))\n                _line = [word]\n                tspan = text.append(\"tspan\")\n                  .attr(\"x\", _x)\n                  .attr(\"y\", _y)\n                  .attr(\"dy\", `${(++lineNumber * lineHeight) + dy}em`)\n                  .text(word);\n              }\n            }\n\n            titleLines = lineNumber * lineHeight\n          });\n        }, width - (titlePadding * 2))\n    }\n\n    let fontSize = parseFloat(getComputedStyle(g.node()).fontSize);\n\n    g.append(\"text\")\n      .attr(\"x\", 0)\n      .attr(\"dy\", title.length ? (titlePadding * 2) + (titleLines * fontSize) : (titlePadding * 1.25))\n      .attr(\"class\", \"sum\")\n      .text(data[data.length - 1].value.toLocaleString())\n  }\n}\n"]},"metadata":{},"sourceType":"module"}