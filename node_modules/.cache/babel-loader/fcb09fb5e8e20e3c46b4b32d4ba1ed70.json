{"ast":null,"code":"function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n/* eslint-disable require-jsdoc */\n\n\nvar DynamicFieldsComponent = /*#__PURE__*/function () {\n  function DynamicFieldsComponent() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, DynamicFieldsComponent);\n\n    this.wrapperSelector = options.wrapperSelector;\n    this.containerSelector = options.containerSelector;\n    this.fieldSelector = options.fieldSelector;\n    this.addFieldButtonSelector = options.addFieldButtonSelector;\n    this.addSeparatorButtonSelector = options.addSeparatorButtonSelector;\n    this.addTitleAndDescriptionButtonSelector = options.addTitleAndDescriptionButtonSelector;\n    this.fieldTemplateSelector = options.fieldTemplateSelector;\n    this.separatorTemplateSelector = options.separatorTemplateSelector;\n    this.TitleAndDescriptionTemplateSelector = options.TitleAndDescriptionTemplateSelector;\n    this.removeFieldButtonSelector = options.removeFieldButtonSelector;\n    this.moveUpFieldButtonSelector = options.moveUpFieldButtonSelector;\n    this.moveDownFieldButtonSelector = options.moveDownFieldButtonSelector;\n    this.onAddField = options.onAddField;\n    this.onRemoveField = options.onRemoveField;\n    this.onMoveUpField = options.onMoveUpField;\n    this.onMoveDownField = options.onMoveDownField;\n    this.placeholderId = options.placeholderId;\n    this.elementCounter = 0;\n\n    this._enableInterpolation();\n\n    this._activateFields();\n\n    this._bindEvents();\n  }\n\n  _createClass(DynamicFieldsComponent, [{\n    key: \"_enableInterpolation\",\n    value: function _enableInterpolation() {\n      $.fn.replaceAttribute = function (attribute, placeholder, value) {\n        $(this).find(\"[\".concat(attribute, \"*=\").concat(placeholder, \"]\")).addBack(\"[\".concat(attribute, \"*=\").concat(placeholder, \"]\")).each(function (index, element) {\n          $(element).attr(attribute, $(element).attr(attribute).replace(placeholder, value));\n        });\n        return this;\n      };\n\n      $.fn.template = function (placeholder, value) {\n        // See the comment below in the `_addField()` method regarding the\n        // `<template>` tag support in IE11.\n        var $subtemplate = $(this).find(\"template, .decidim-template\");\n\n        if ($subtemplate.length > 0) {\n          $subtemplate.html(function (index, oldHtml) {\n            return $(oldHtml).template(placeholder, value)[0].outerHTML;\n          });\n        } // Handle those subtemplates that are mapped with the `data-template`\n        // attribute. This is also because of the IE11 support.\n\n\n        var $subtemplateParents = $(this).find(\"[data-template]\");\n\n        if ($subtemplateParents.length > 0) {\n          $subtemplateParents.each(function (_i, elem) {\n            var $self = $(elem);\n            var $tpl = $($self.data(\"template\")); // Duplicate the sub-template with a unique ID as there may be\n            // multiple parent templates referring to the same sub-template.\n\n            var $subtpl = $($tpl[0].outerHTML);\n            var subtemplateId = \"\".concat($tpl.attr(\"id\"), \"-\").concat(value);\n            var subtemplateSelector = \"#\".concat(subtemplateId);\n            $subtpl.attr(\"id\", subtemplateId);\n            $self.attr(\"data-template\", subtemplateSelector).data(\"template\", subtemplateSelector);\n            $tpl.after($subtpl);\n            $subtpl.html(function (index, oldHtml) {\n              return $(oldHtml).template(placeholder, value)[0].outerHTML;\n            });\n          });\n        }\n\n        $(this).replaceAttribute(\"id\", placeholder, value);\n        $(this).replaceAttribute(\"name\", placeholder, value);\n        $(this).replaceAttribute(\"data-tabs-content\", placeholder, value);\n        $(this).replaceAttribute(\"for\", placeholder, value);\n        $(this).replaceAttribute(\"tabs_id\", placeholder, value);\n        $(this).replaceAttribute(\"href\", placeholder, value);\n        return this;\n      };\n    }\n  }, {\n    key: \"_bindEvents\",\n    value: function _bindEvents() {\n      var _this = this;\n\n      $(this.wrapperSelector).on(\"click\", this.addFieldButtonSelector, function (event) {\n        return _this._bindSafeEvent(event, function () {\n          return _this._addField(_this.fieldTemplateSelector);\n        });\n      });\n\n      if (this.addSeparatorButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.addSeparatorButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function () {\n            return _this._addField(_this.separatorTemplateSelector);\n          });\n        });\n      }\n\n      if (this.addTitleAndDescriptionButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.addTitleAndDescriptionButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function () {\n            return _this._addField(_this.TitleAndDescriptionTemplateSelector);\n          });\n        });\n      }\n\n      $(this.wrapperSelector).on(\"click\", this.removeFieldButtonSelector, function (event) {\n        return _this._bindSafeEvent(event, function (target) {\n          return _this._removeField(target);\n        });\n      });\n\n      if (this.moveUpFieldButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.moveUpFieldButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function (target) {\n            return _this._moveUpField(target);\n          });\n        });\n      }\n\n      if (this.moveDownFieldButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.moveDownFieldButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function (target) {\n            return _this._moveDownField(target);\n          });\n        });\n      }\n    }\n  }, {\n    key: \"_bindSafeEvent\",\n    value: function _bindSafeEvent(event, cb) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      try {\n        return cb(event.target);\n      } catch (error) {\n        console.error(error); // eslint-disable-line no-console\n\n        return error;\n      }\n    } // Adds a field.\n    //\n    // template - A String matching the type of the template. Expected to be\n    //  either \".decidim-question-template\" or \".decidim-separator-template\".\n\n  }, {\n    key: \"_addField\",\n    value: function _addField() {\n      var templateClass = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \".decidim-template\";\n      var $wrapper = $(this.wrapperSelector);\n      var $container = $wrapper.find(this.containerSelector); // Allow defining the template using a `data-template` attribute on the\n      // wrapper element. This is to allow child templates which would otherwise\n      // be impossible using `<script type=\"text/template\">`. See the comment\n      // below regarding the `<template>` tag and IE11.\n\n      var templateSelector = $wrapper.data(\"template\");\n      var $template = null;\n\n      if (templateSelector) {\n        $template = $(templateSelector);\n      }\n\n      if ($template === null || $template.length < 1) {\n        // To preserve IE11 backwards compatibility, the views are using\n        // `<script type=\"text/template\">` with a given `class` instead of\n        // `<template>`. The `<template> tags are parsed in IE11 along with the\n        // DOM which may cause the form elements inside them to break the forms\n        // as they are submitted with them.\n        $template = $wrapper.children(\"template, \".concat(templateClass));\n      }\n\n      var $newField = $($template.html()).template(this.placeholderId, this._getUID());\n      $newField.find(\"ul.tabs\").attr(\"data-tabs\", true);\n      var $lastQuestion = $container.find(this.fieldSelector).last();\n\n      if ($lastQuestion.length > 0) {\n        $lastQuestion.after($newField);\n      } else {\n        $newField.appendTo($container);\n      }\n\n      $newField.foundation();\n\n      if (this.onAddField) {\n        this.onAddField($newField);\n      }\n    }\n  }, {\n    key: \"_removeField\",\n    value: function _removeField(target) {\n      var $target = $(target);\n      var $removedField = $target.parents(this.fieldSelector);\n      var idInput = $removedField.find(\"input\").filter(function (idx, input) {\n        return input.name.match(/id/);\n      });\n\n      if (idInput.length > 0) {\n        var deletedInput = $removedField.find(\"input\").filter(function (idx, input) {\n          return input.name.match(/delete/);\n        });\n\n        if (deletedInput.length > 0) {\n          $(deletedInput[0]).val(true);\n        }\n\n        $removedField.addClass(\"hidden\");\n        $removedField.hide();\n      } else {\n        $removedField.remove();\n      }\n\n      if (this.onRemoveField) {\n        this.onRemoveField($removedField);\n      }\n    }\n  }, {\n    key: \"_moveUpField\",\n    value: function _moveUpField(target) {\n      var $target = $(target);\n      var $movedUpField = $target.parents(this.fieldSelector);\n      $movedUpField.prev().before($movedUpField);\n\n      if (this.onMoveUpField) {\n        this.onMoveUpField($movedUpField);\n      }\n    }\n  }, {\n    key: \"_moveDownField\",\n    value: function _moveDownField(target) {\n      var $target = $(target);\n      var $movedDownField = $target.parents(this.fieldSelector);\n      $movedDownField.next().after($movedDownField);\n\n      if (this.onMoveDownField) {\n        this.onMoveDownField($movedDownField);\n      }\n    }\n  }, {\n    key: \"_activateFields\",\n    value: function _activateFields() {\n      var _this2 = this; // Move the `<script type=\"text/template\">` elements to the bottom of the\n      // list container so that they will not cause the question moving\n      // functionality to break since it assumes that all children elements are\n      // the dynamic field list child items.\n\n\n      var $wrapper = $(this.wrapperSelector);\n      var $container = $wrapper.find(this.containerSelector);\n      $container.append($container.find(\"script\"));\n      $(this.fieldSelector).each(function (idx, el) {\n        $(el).template(_this2.placeholderId, _this2._getUID());\n        $(el).find(\"ul.tabs\").attr(\"data-tabs\", true);\n      });\n    }\n  }, {\n    key: \"_getUID\",\n    value: function _getUID() {\n      this.elementCounter += 1;\n      return new Date().getTime() + this.elementCounter;\n    }\n  }]);\n\n  return DynamicFieldsComponent;\n}();\n\nexport default function createDynamicFields(options) {\n  return new DynamicFieldsComponent(options);\n}","map":{"version":3,"mappings":"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","names":["DynamicFieldsComponent","options","_classCallCheck","wrapperSelector","containerSelector","fieldSelector","addFieldButtonSelector","addSeparatorButtonSelector","addTitleAndDescriptionButtonSelector","fieldTemplateSelector","separatorTemplateSelector","TitleAndDescriptionTemplateSelector","removeFieldButtonSelector","moveUpFieldButtonSelector","moveDownFieldButtonSelector","onAddField","onRemoveField","onMoveUpField","onMoveDownField","placeholderId","elementCounter","_enableInterpolation","_activateFields","_bindEvents","$","fn","replaceAttribute","attribute","placeholder","value","find","addBack","each","index","element","attr","replace","template","$subtemplate","length","html","oldHtml","outerHTML","$subtemplateParents","_i","elem","$self","$tpl","data","$subtpl","subtemplateId","subtemplateSelector","after","on","event","_this","_bindSafeEvent","_addField","target","_removeField","_moveUpField","_moveDownField","cb","preventDefault","stopPropagation","error","console","templateClass","$wrapper","$container","templateSelector","$template","children","$newField","_getUID","$lastQuestion","last","appendTo","foundation","$target","$removedField","parents","idInput","filter","idx","input","name","match","deletedInput","val","addClass","hide","remove","$movedUpField","prev","before","$movedDownField","next","append","el","_this2","Date","getTime","createDynamicFields"],"sources":["/home/agustibr/.asdf/installs/ruby/3.0.2/lib/ruby/gems/3.0.0/bundler/gems/decidim-a25b5c74f78d/decidim-admin/app/packs/src/decidim/admin/dynamic_fields.component.js"],"sourcesContent":["/* eslint-disable require-jsdoc */\nclass DynamicFieldsComponent {\n  constructor(options = {}) {\n    this.wrapperSelector = options.wrapperSelector;\n    this.containerSelector = options.containerSelector;\n    this.fieldSelector = options.fieldSelector;\n    this.addFieldButtonSelector = options.addFieldButtonSelector;\n    this.addSeparatorButtonSelector = options.addSeparatorButtonSelector;\n    this.addTitleAndDescriptionButtonSelector = options.addTitleAndDescriptionButtonSelector;\n    this.fieldTemplateSelector = options.fieldTemplateSelector;\n    this.separatorTemplateSelector = options.separatorTemplateSelector;\n    this.TitleAndDescriptionTemplateSelector = options.TitleAndDescriptionTemplateSelector;\n    this.removeFieldButtonSelector = options.removeFieldButtonSelector;\n    this.moveUpFieldButtonSelector = options.moveUpFieldButtonSelector;\n    this.moveDownFieldButtonSelector = options.moveDownFieldButtonSelector;\n    this.onAddField = options.onAddField;\n    this.onRemoveField = options.onRemoveField;\n    this.onMoveUpField = options.onMoveUpField;\n    this.onMoveDownField = options.onMoveDownField;\n    this.placeholderId = options.placeholderId;\n    this.elementCounter = 0;\n    this._enableInterpolation();\n    this._activateFields();\n    this._bindEvents();\n  }\n\n  _enableInterpolation() {\n    $.fn.replaceAttribute = function(attribute, placeholder, value) {\n      $(this).find(`[${attribute}*=${placeholder}]`).addBack(`[${attribute}*=${placeholder}]`).each((index, element) => {\n        $(element).attr(attribute, $(element).attr(attribute).replace(placeholder, value));\n      });\n\n      return this;\n    }\n\n    $.fn.template = function(placeholder, value) {\n      // See the comment below in the `_addField()` method regarding the\n      // `<template>` tag support in IE11.\n      const $subtemplate = $(this).find(\"template, .decidim-template\");\n\n      if ($subtemplate.length > 0) {\n        $subtemplate.html((index, oldHtml) => $(oldHtml).template(placeholder, value)[0].outerHTML);\n      }\n\n      // Handle those subtemplates that are mapped with the `data-template`\n      // attribute. This is also because of the IE11 support.\n      const $subtemplateParents = $(this).find(\"[data-template]\");\n\n      if ($subtemplateParents.length > 0) {\n        $subtemplateParents.each((_i, elem) => {\n          const $self = $(elem);\n          const $tpl = $($self.data(\"template\"));\n\n          // Duplicate the sub-template with a unique ID as there may be\n          // multiple parent templates referring to the same sub-template.\n          const $subtpl = $($tpl[0].outerHTML);\n          const subtemplateId = `${$tpl.attr(\"id\")}-${value}`;\n          const subtemplateSelector = `#${subtemplateId}`;\n          $subtpl.attr(\"id\", subtemplateId);\n          $self.attr(\"data-template\", subtemplateSelector).data(\"template\", subtemplateSelector);\n          $tpl.after($subtpl);\n\n          $subtpl.html((index, oldHtml) => $(oldHtml).template(placeholder, value)[0].outerHTML);\n        });\n      }\n\n      $(this).replaceAttribute(\"id\", placeholder, value);\n      $(this).replaceAttribute(\"name\", placeholder, value);\n      $(this).replaceAttribute(\"data-tabs-content\", placeholder, value);\n      $(this).replaceAttribute(\"for\", placeholder, value);\n      $(this).replaceAttribute(\"tabs_id\", placeholder, value);\n      $(this).replaceAttribute(\"href\", placeholder, value);\n\n      return this;\n    }\n  }\n\n  _bindEvents() {\n    $(this.wrapperSelector).on(\"click\", this.addFieldButtonSelector, (event) =>\n      this._bindSafeEvent(event, () => this._addField(this.fieldTemplateSelector))\n    );\n\n    if (this.addSeparatorButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.addSeparatorButtonSelector, (event) =>\n        this._bindSafeEvent(event, () => this._addField(this.separatorTemplateSelector))\n      );\n    }\n\n    if (this.addTitleAndDescriptionButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.addTitleAndDescriptionButtonSelector, (event) =>\n        this._bindSafeEvent(event, () => this._addField(this.TitleAndDescriptionTemplateSelector))\n      );\n    }\n\n    $(this.wrapperSelector).on(\"click\", this.removeFieldButtonSelector, (event) =>\n      this._bindSafeEvent(event, (target) => this._removeField(target))\n    );\n\n    if (this.moveUpFieldButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.moveUpFieldButtonSelector, (event) =>\n        this._bindSafeEvent(event, (target) => this._moveUpField(target))\n      );\n    }\n\n    if (this.moveDownFieldButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.moveDownFieldButtonSelector, (event) =>\n        this._bindSafeEvent(event, (target) => this._moveDownField(target))\n      );\n    }\n  }\n\n  _bindSafeEvent(event, cb) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    try {\n      return cb(event.target);\n    } catch (error) {\n      console.error(error); // eslint-disable-line no-console\n      return error;\n    }\n  }\n\n  // Adds a field.\n  //\n  // template - A String matching the type of the template. Expected to be\n  //  either \".decidim-question-template\" or \".decidim-separator-template\".\n  _addField(templateClass = \".decidim-template\") {\n    const $wrapper = $(this.wrapperSelector);\n    const $container = $wrapper.find(this.containerSelector);\n\n    // Allow defining the template using a `data-template` attribute on the\n    // wrapper element. This is to allow child templates which would otherwise\n    // be impossible using `<script type=\"text/template\">`. See the comment\n    // below regarding the `<template>` tag and IE11.\n    const templateSelector = $wrapper.data(\"template\");\n    let $template = null;\n    if (templateSelector) {\n      $template = $(templateSelector);\n    }\n    if ($template === null || $template.length < 1) {\n      // To preserve IE11 backwards compatibility, the views are using\n      // `<script type=\"text/template\">` with a given `class` instead of\n      // `<template>`. The `<template> tags are parsed in IE11 along with the\n      // DOM which may cause the form elements inside them to break the forms\n      // as they are submitted with them.\n      $template = $wrapper.children(`template, ${templateClass}`);\n    }\n\n    const $newField = $($template.html()).template(this.placeholderId, this._getUID());\n\n    $newField.find(\"ul.tabs\").attr(\"data-tabs\", true);\n\n    const $lastQuestion = $container.find(this.fieldSelector).last()\n    if ($lastQuestion.length > 0) {\n      $lastQuestion.after($newField);\n    } else {\n      $newField.appendTo($container);\n    }\n\n    $newField.foundation();\n\n    if (this.onAddField) {\n      this.onAddField($newField);\n    }\n  }\n\n  _removeField(target) {\n    const $target = $(target);\n    const $removedField = $target.parents(this.fieldSelector);\n    const idInput = $removedField.find(\"input\").filter((idx, input) => input.name.match(/id/));\n\n    if (idInput.length > 0) {\n      const deletedInput = $removedField.find(\"input\").filter((idx, input) => input.name.match(/delete/));\n\n      if (deletedInput.length > 0) {\n        $(deletedInput[0]).val(true);\n      }\n\n      $removedField.addClass(\"hidden\");\n      $removedField.hide();\n    } else {\n      $removedField.remove();\n    }\n\n    if (this.onRemoveField) {\n      this.onRemoveField($removedField);\n    }\n  }\n\n  _moveUpField(target) {\n    const $target = $(target);\n    const $movedUpField = $target.parents(this.fieldSelector);\n\n    $movedUpField.prev().before($movedUpField);\n\n    if (this.onMoveUpField) {\n      this.onMoveUpField($movedUpField);\n    }\n  }\n\n  _moveDownField(target) {\n    const $target = $(target);\n    const $movedDownField = $target.parents(this.fieldSelector);\n\n    $movedDownField.next().after($movedDownField);\n\n    if (this.onMoveDownField) {\n      this.onMoveDownField($movedDownField);\n    }\n  }\n\n  _activateFields() {\n    // Move the `<script type=\"text/template\">` elements to the bottom of the\n    // list container so that they will not cause the question moving\n    // functionality to break since it assumes that all children elements are\n    // the dynamic field list child items.\n    const $wrapper = $(this.wrapperSelector);\n    const $container = $wrapper.find(this.containerSelector);\n    $container.append($container.find(\"script\"));\n\n    $(this.fieldSelector).each((idx, el) => {\n      $(el).template(this.placeholderId, this._getUID());\n\n      $(el).find(\"ul.tabs\").attr(\"data-tabs\", true);\n    })\n  }\n\n  _getUID() {\n    this.elementCounter += 1;\n\n    return (new Date().getTime()) + this.elementCounter;\n  }\n}\n\nexport default function createDynamicFields(options) {\n  return new DynamicFieldsComponent(options);\n}\n"]},"metadata":{},"sourceType":"module"}