{"ast":null,"code":"import \"src/decidim/geocoding\";\nimport formatAddress from \"src/decidim/geocoding/format_address\";\n/**\n * For the available address format keys, refer to:\n * https://developer.here.com/documentation/geocoder-autocomplete/dev_guide/topics/resource-type-response-suggest.html\n */\n\n$(function () {\n  var generateAddressLabel = formatAddress;\n  $(\"[data-decidim-geocoding]\").each(function (_i, el) {\n    var $input = $(el);\n    var config = $input.data(\"decidim-geocoding\");\n    var queryMinLength = config.queryMinLength || 2;\n    var addressFormat = config.addressFormat || [[\"street\", \"houseNumber\"], \"district\", \"city\", \"county\", \"state\", \"country\"];\n    var language = $(\"html\").attr(\"lang\");\n    var currentSuggestionQuery = null;\n\n    if (!config.apiKey || config.apiKey.length < 1) {\n      return;\n    }\n\n    $input.on(\"geocoder-suggest.decidim\", function (_ev, query, callback) {\n      clearTimeout(currentSuggestionQuery); // Do not trigger API calls on short queries\n\n      if (\"\".concat(query).trim().length < queryMinLength) {\n        return;\n      }\n\n      currentSuggestionQuery = setTimeout(function () {\n        $.ajax({\n          method: \"GET\",\n          url: \"https://autocomplete.geocoder.ls.hereapi.com/6.2/suggest.json\",\n          data: {\n            apiKey: config.apiKey,\n            query: query,\n            language: language\n          },\n          dataType: \"json\"\n        }).done(function (resp) {\n          if (resp.suggestions) {\n            return callback(resp.suggestions.map(function (item) {\n              var label = generateAddressLabel(item.address, addressFormat);\n              return {\n                key: label,\n                value: label,\n                locationId: item.locationId\n              };\n            }));\n          }\n\n          return null;\n        });\n      }, 200);\n    });\n    $input.on(\"geocoder-suggest-select.decidim\", function (_ev, selectedItem) {\n      $.ajax({\n        method: \"GET\",\n        url: \"https://geocoder.ls.hereapi.com/6.2/geocode.json\",\n        data: {\n          apiKey: config.apiKey,\n          gen: 9,\n          jsonattributes: 1,\n          locationid: selectedItem.locationId\n        },\n        dataType: \"json\"\n      }).done(function (resp) {\n        if (!resp.response || !Array.isArray(resp.response.view) || resp.response.view.length < 1) {\n          return;\n        }\n\n        var view = resp.response.view[0];\n\n        if (!Array.isArray(view.result) || view.result.length < 1) {\n          return;\n        }\n\n        var result = view.result[0];\n        var coordinates = [result.location.displayPosition.latitude, result.location.displayPosition.longitude];\n        $input.trigger(\"geocoder-suggest-coordinates.decidim\", [coordinates]);\n      });\n    });\n  });\n});","map":{"version":3,"mappings":"AAAA,OAAO,uBAAP;AACA,OAAOA,aAAP,MAA0B,sCAA1B;AAEA;AACA;AACA;AACA;;AACAC,CAAC,CAAC,YAAM;EACN,IAAMC,oBAAoB,GAAGF,aAA7B;EAEAC,CAAC,CAAC,0BAAD,CAADA,CAA8BE,IAA9BF,CAAmC,UAACG,EAAD,EAAKC,EAAL,EAAY;IAC7C,IAAMC,MAAM,GAAGL,CAAC,CAACI,EAAD,CAAhB;IACA,IAAME,MAAM,GAAGD,MAAM,CAACE,IAAPF,CAAY,mBAAZA,CAAf;IACA,IAAMG,cAAc,GAAGF,MAAM,CAACE,cAAPF,IAAyB,CAAhD;IACA,IAAMG,aAAa,GAAGH,MAAM,CAACG,aAAPH,IAAwB,CAC5C,CAAC,QAAD,EAAW,aAAX,CAD4C,EAE5C,UAF4C,EAG5C,MAH4C,EAI5C,QAJ4C,EAK5C,OAL4C,EAM5C,SAN4C,CAA9C;IAQA,IAAMI,QAAQ,GAAGV,CAAC,CAAC,MAAD,CAADA,CAAUW,IAAVX,CAAe,MAAfA,CAAjB;IACA,IAAIY,sBAAsB,GAAG,IAA7B;;IAEA,IAAI,CAACN,MAAM,CAACO,MAAR,IAAkBP,MAAM,CAACO,MAAPP,CAAcQ,MAAdR,GAAuB,CAA7C,EAAgD;MAC9C;IACD;;IAEDD,MAAM,CAACU,EAAPV,CAAU,0BAAVA,EAAsC,UAACW,GAAD,EAAMC,KAAN,EAAaC,QAAb,EAA0B;MAC9DC,YAAY,CAACP,sBAAD,CAAZO,CAD8D,CAG9D;;MACA,IAAI,UAAGF,KAAH,EAAWG,IAAX,GAAkBN,MAAlB,GAA2BN,cAA/B,EAA+C;QAC7C;MACD;;MAEDI,sBAAsB,GAAGS,UAAU,CAAC,YAAM;QACxCrB,CAAC,CAACsB,IAAFtB,CAAO;UACLuB,MAAM,EAAE,KADH;UAELC,GAAG,EAAE,+DAFA;UAGLjB,IAAI,EAAE;YACJM,MAAM,EAAEP,MAAM,CAACO,MADX;YAEJI,KAAK,EAAEA,KAFH;YAGJP,QAAQ,EAAEA;UAHN,CAHD;UAQLe,QAAQ,EAAE;QARL,CAAPzB,EASG0B,IATH1B,CASQ,UAAC2B,IAAD,EAAU;UAChB,IAAIA,IAAI,CAACC,WAAT,EAAsB;YACpB,OAAOV,QAAQ,CAACS,IAAI,CAACC,WAALD,CAAiBE,GAAjBF,CAAqB,UAACG,IAAD,EAAU;cAC7C,IAAMC,KAAK,GAAG9B,oBAAoB,CAAC6B,IAAI,CAACE,OAAN,EAAevB,aAAf,CAAlC;cAEA,OAAO;gBACLwB,GAAG,EAAEF,KADA;gBAELG,KAAK,EAAEH,KAFF;gBAGLI,UAAU,EAAEL,IAAI,CAACK;cAHZ,CAAP;YAHc,EAAD,CAAf;UASD;;UACD,OAAO,IAAP;QArBF;MADiC,GAwBhC,GAxBgC,CAAnCvB;IARF;IAmCAP,MAAM,CAACU,EAAPV,CAAU,iCAAVA,EAA6C,UAACW,GAAD,EAAMoB,YAAN,EAAuB;MAClEpC,CAAC,CAACsB,IAAFtB,CAAO;QACLuB,MAAM,EAAE,KADH;QAELC,GAAG,EAAE,kDAFA;QAGLjB,IAAI,EAAE;UACJM,MAAM,EAAEP,MAAM,CAACO,MADX;UAEJwB,GAAG,EAAE,CAFD;UAGJC,cAAc,EAAE,CAHZ;UAIJC,UAAU,EAAEH,YAAY,CAACD;QAJrB,CAHD;QASLV,QAAQ,EAAE;MATL,CAAPzB,EAUG0B,IAVH1B,CAUQ,UAAC2B,IAAD,EAAU;QAChB,IAAI,CAACA,IAAI,CAACa,QAAN,IAAkB,CAACC,KAAK,CAACC,OAAND,CAAcd,IAAI,CAACa,QAALb,CAAcgB,IAA5BF,CAAnB,IACFd,IAAI,CAACa,QAALb,CAAcgB,IAAdhB,CAAmBb,MAAnBa,GAA4B,CAD9B,EAEE;UACA;QACD;;QAED,IAAMgB,IAAI,GAAGhB,IAAI,CAACa,QAALb,CAAcgB,IAAdhB,CAAmB,CAAnBA,CAAb;;QACA,IAAI,CAACc,KAAK,CAACC,OAAND,CAAcE,IAAI,CAACC,MAAnBH,CAAD,IAA+BE,IAAI,CAACC,MAALD,CAAY7B,MAAZ6B,GAAqB,CAAxD,EAA2D;UACzD;QACD;;QAED,IAAMC,MAAM,GAAGD,IAAI,CAACC,MAALD,CAAY,CAAZA,CAAf;QACA,IAAME,WAAW,GAAG,CAClBD,MAAM,CAACE,QAAPF,CAAgBG,eAAhBH,CAAgCI,QADd,EAElBJ,MAAM,CAACE,QAAPF,CAAgBG,eAAhBH,CAAgCK,SAFd,CAApB;QAKA5C,MAAM,CAAC6C,OAAP7C,CACE,sCADFA,EAEE,CAACwC,WAAD,CAFFxC;MA5BF;IADF;EAtDF;AAHD,EAADL","names":["formatAddress","$","generateAddressLabel","each","_i","el","$input","config","data","queryMinLength","addressFormat","language","attr","currentSuggestionQuery","apiKey","length","on","_ev","query","callback","clearTimeout","trim","setTimeout","ajax","method","url","dataType","done","resp","suggestions","map","item","label","address","key","value","locationId","selectedItem","gen","jsonattributes","locationid","response","Array","isArray","view","result","coordinates","location","displayPosition","latitude","longitude","trigger"],"sources":["/home/agustibr/.asdf/installs/ruby/3.0.2/lib/ruby/gems/3.0.0/bundler/gems/decidim-a25b5c74f78d/decidim-core/app/packs/src/decidim/geocoding/provider/here.js"],"sourcesContent":["import \"src/decidim/geocoding\"\nimport formatAddress from \"src/decidim/geocoding/format_address\"\n\n/**\n * For the available address format keys, refer to:\n * https://developer.here.com/documentation/geocoder-autocomplete/dev_guide/topics/resource-type-response-suggest.html\n */\n$(() => {\n  const generateAddressLabel = formatAddress;\n\n  $(\"[data-decidim-geocoding]\").each((_i, el) => {\n    const $input = $(el);\n    const config = $input.data(\"decidim-geocoding\");\n    const queryMinLength = config.queryMinLength || 2;\n    const addressFormat = config.addressFormat || [\n      [\"street\", \"houseNumber\"],\n      \"district\",\n      \"city\",\n      \"county\",\n      \"state\",\n      \"country\"\n    ];\n    const language = $(\"html\").attr(\"lang\");\n    let currentSuggestionQuery = null;\n\n    if (!config.apiKey || config.apiKey.length < 1) {\n      return;\n    }\n\n    $input.on(\"geocoder-suggest.decidim\", (_ev, query, callback) => {\n      clearTimeout(currentSuggestionQuery);\n\n      // Do not trigger API calls on short queries\n      if (`${query}`.trim().length < queryMinLength) {\n        return;\n      }\n\n      currentSuggestionQuery = setTimeout(() => {\n        $.ajax({\n          method: \"GET\",\n          url: \"https://autocomplete.geocoder.ls.hereapi.com/6.2/suggest.json\",\n          data: {\n            apiKey: config.apiKey,\n            query: query,\n            language: language\n          },\n          dataType: \"json\"\n        }).done((resp) => {\n          if (resp.suggestions) {\n            return callback(resp.suggestions.map((item) => {\n              const label = generateAddressLabel(item.address, addressFormat);\n\n              return {\n                key: label,\n                value: label,\n                locationId: item.locationId\n              }\n            }));\n          }\n          return null;\n        });\n      }, 200);\n    });\n\n    $input.on(\"geocoder-suggest-select.decidim\", (_ev, selectedItem) => {\n      $.ajax({\n        method: \"GET\",\n        url: \"https://geocoder.ls.hereapi.com/6.2/geocode.json\",\n        data: {\n          apiKey: config.apiKey,\n          gen: 9,\n          jsonattributes: 1,\n          locationid: selectedItem.locationId\n        },\n        dataType: \"json\"\n      }).done((resp) => {\n        if (!resp.response || !Array.isArray(resp.response.view) ||\n          resp.response.view.length < 1\n        ) {\n          return;\n        }\n\n        const view = resp.response.view[0];\n        if (!Array.isArray(view.result) || view.result.length < 1) {\n          return;\n        }\n\n        const result = view.result[0];\n        const coordinates = [\n          result.location.displayPosition.latitude,\n          result.location.displayPosition.longitude\n        ];\n\n        $input.trigger(\n          \"geocoder-suggest-coordinates.decidim\",\n          [coordinates]\n        );\n      });\n    });\n  })\n})\n"]},"metadata":{},"sourceType":"module"}