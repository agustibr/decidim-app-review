{"ast":null,"code":"var currentAllocationZero = function currentAllocationZero() {\n  var $budgetSummary = $(\".budget-summary__progressbox\");\n  return parseInt($budgetSummary.attr(\"data-current-allocation\"), 10) === 0;\n};\n\nvar isSafeUrl = function isSafeUrl(exitUrl) {\n  if (!exitUrl) {\n    return false;\n  }\n\n  var safeUrls = [$(\".budget-summary\").attr(\"data-safe-url\").split(\"?\")[0], \"\".concat(location.pathname, \"#\"), \"\".concat(location.href, \"#\"), \"#\"];\n  var safe = false;\n  safeUrls.forEach(function (url) {\n    if (exitUrl.startsWith(url)) {\n      safe = true;\n    }\n  });\n  return safe;\n};\n\nvar allowExitFrom = function allowExitFrom($el) {\n  if (currentAllocationZero()) {\n    return true;\n  } else if ($el.attr(\"target\") === \"_blank\") {\n    return true;\n  } else if ($el.parents(\"#loginModal\").length > 0) {\n    return true;\n  } else if ($el.parents(\"#authorizationModal\").length > 0) {\n    return true;\n  } else if ($el.attr(\"id\") === \"exit-notification-link\") {\n    return true;\n  } else if ($el.parents(\".voting-wrapper\").length > 0) {\n    return true;\n  } else if (isSafeUrl($el.attr(\"href\"))) {\n    return true;\n  }\n\n  return false;\n};\n\n$(function () {\n  var $exitNotification = $(\"#exit-notification\");\n  var $exitLink = $(\"#exit-notification-link\");\n  var defaultExitUrl = $exitLink.attr(\"href\");\n  var defaultExitLinkText = $exitLink.text();\n  var exitLinkText = defaultExitLinkText;\n\n  if ($exitNotification.length < 1) {\n    // Do not apply when not inside the voting pipeline\n    return;\n  }\n\n  var openExitNotification = function openExitNotification(url) {\n    var method = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n    if (method && method !== \"get\") {\n      $exitLink.attr(\"data-method\", method);\n    } else {\n      $exitLink.removeAttr(\"data-method\");\n    }\n\n    $exitLink.attr(\"href\", url);\n    $exitLink.html(exitLinkText);\n    $exitNotification.foundation(\"open\");\n  };\n\n  $(document).on(\"click\", \"a\", function (event) {\n    exitLinkText = defaultExitLinkText;\n    var $link = $(event.currentTarget);\n\n    if (!allowExitFrom($link)) {\n      event.preventDefault();\n      openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n    }\n  }); // Custom handling for the header sign out so that it won't trigger the\n  // logout form submit and so that it changes the exit link text. This does\n  // not trigger the document link click listener because it has the\n  // data-method attribute to trigger a form submit event.\n\n  $(\".header a.sign-out-link\").on(\"click\", function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n    var $link = $(event.currentTarget);\n    exitLinkText = $link.text();\n    openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n  }); // Custom handling for the exit link which needs to change the exit link\n  // text to the default text as this is not handled by the document click\n  // listener.\n\n  $(\"a[data-open='exit-notification']\").on(\"click\", function () {\n    exitLinkText = defaultExitLinkText;\n    openExitNotification(defaultExitUrl);\n  });\n});","map":{"version":3,"mappings":"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","names":["currentAllocationZero","$budgetSummary","$","parseInt","attr","isSafeUrl","exitUrl","safeUrls","split","location","pathname","href","safe","forEach","url","startsWith","allowExitFrom","$el","parents","length","$exitNotification","$exitLink","defaultExitUrl","defaultExitLinkText","text","exitLinkText","openExitNotification","method","removeAttr","html","foundation","document","on","event","$link","currentTarget","preventDefault","data","stopPropagation"],"sources":["/home/agustibr/.asdf/installs/ruby/3.0.2/lib/ruby/gems/3.0.0/bundler/gems/decidim-a25b5c74f78d/decidim-budgets/app/packs/src/decidim/budgets/exit_handler.js"],"sourcesContent":["const currentAllocationZero = () => {\n  const $budgetSummary = $(\".budget-summary__progressbox\");\n  return parseInt($budgetSummary.attr(\"data-current-allocation\"), 10) === 0;\n}\n\nconst isSafeUrl = (exitUrl) => {\n  if (!exitUrl) {\n    return false\n  }\n\n  const safeUrls = [\n    $(\".budget-summary\").attr(\"data-safe-url\").split(\"?\")[0],\n    `${location.pathname}#`,\n    `${location.href}#`,\n    \"#\"\n  ];\n\n  let safe = false;\n  safeUrls.forEach((url) => {\n    if (exitUrl.startsWith(url)) {\n      safe =  true\n    }\n  });\n\n  return safe;\n}\n\nconst allowExitFrom = ($el) => {\n  if (currentAllocationZero()) {\n    return true\n  } else if ($el.attr(\"target\") === \"_blank\") {\n    return true;\n  } else if ($el.parents(\"#loginModal\").length > 0) {\n    return true;\n  } else if ($el.parents(\"#authorizationModal\").length > 0) {\n    return true;\n  } else if ($el.attr(\"id\") === \"exit-notification-link\") {\n    return true;\n  } else if ($el.parents(\".voting-wrapper\").length > 0) {\n    return true;\n  } else if (isSafeUrl($el.attr(\"href\"))) {\n    return true\n  }\n\n  return false;\n}\n\n$(() => {\n  const $exitNotification = $(\"#exit-notification\");\n  const $exitLink = $(\"#exit-notification-link\");\n  const defaultExitUrl = $exitLink.attr(\"href\");\n  const defaultExitLinkText = $exitLink.text();\n  let exitLinkText = defaultExitLinkText;\n\n  if ($exitNotification.length < 1) {\n    // Do not apply when not inside the voting pipeline\n    return;\n  }\n\n  const openExitNotification = (url, method = null) => {\n    if (method && method !== \"get\") {\n      $exitLink.attr(\"data-method\", method);\n    } else {\n      $exitLink.removeAttr(\"data-method\");\n    }\n\n    $exitLink.attr(\"href\", url);\n    $exitLink.html(exitLinkText);\n    $exitNotification.foundation(\"open\");\n  };\n\n  $(document).on(\"click\", \"a\", (event) => {\n    exitLinkText = defaultExitLinkText;\n\n    const $link = $(event.currentTarget);\n    if (!allowExitFrom($link)) {\n      event.preventDefault();\n      openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n    }\n  });\n  // Custom handling for the header sign out so that it won't trigger the\n  // logout form submit and so that it changes the exit link text. This does\n  // not trigger the document link click listener because it has the\n  // data-method attribute to trigger a form submit event.\n  $(\".header a.sign-out-link\").on(\"click\", (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const $link = $(event.currentTarget);\n    exitLinkText = $link.text();\n    openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n  });\n  // Custom handling for the exit link which needs to change the exit link\n  // text to the default text as this is not handled by the document click\n  // listener.\n  $(\"a[data-open='exit-notification']\").on(\"click\", () => {\n    exitLinkText = defaultExitLinkText;\n    openExitNotification(defaultExitUrl);\n  });\n});\n"]},"metadata":{},"sourceType":"module"}