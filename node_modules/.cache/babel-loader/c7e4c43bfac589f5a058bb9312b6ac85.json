{"ast":null,"code":"/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\";\n$(function () {\n  var $hashtagContainer = $(\".js-hashtags\");\n  var nodatafound = $hashtagContainer.attr(\"data-noresults\");\n  var noMatchTemplate = null;\n\n  if (nodatafound) {\n    noMatchTemplate = function noMatchTemplate() {\n      return \"<li>\".concat(nodatafound, \"</li>\");\n    };\n  } // Listener for the event triggered by quilljs\n\n\n  var cursor = \"\";\n  $hashtagContainer.on(\"quill-position\", function (event) {\n    if (event.detail !== null) {\n      // When replacing the text content after selecting a hashtag, we only need\n      // to know the hashtag's start position as that is the point which we want\n      // to replace.\n      var quill = event.target.__quill;\n\n      if (quill.getText(event.detail.index - 1, 1) === \"#\") {\n        cursor = event.detail.index;\n      }\n    }\n  });\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n\n  var remoteSearch = function remoteSearch(text, cb) {\n    $.post(\"/api\", {\n      query: \"{hashtags(name:\\\"\".concat(text, \"\\\") {name}}\")\n    }).then(function (response) {\n      var data = response.data.hashtags || {};\n      cb(data);\n    }).fail(function () {\n      cb([]);\n    }).always(function () {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n      var $parent = $(tribute.current.element).parent();\n      $parent.addClass(\"is-active\"); // We need to move the container to the wrapper selected\n\n      var $tribute = $parent.find(\".tribute-container\"); // Remove the inline styles, relative to absolute positioning\n\n      $tribute.removeAttr(\"style\");\n    });\n  }; // tribute.js docs - http://github.com/zurb/tribute\n\n  /* global Tribute*/\n\n\n  var tribute = new Tribute({\n    trigger: \"#\",\n    values: function values(text, cb) {\n      remoteSearch(text, function (hashtags) {\n        return cb(hashtags);\n      });\n    },\n    positionMenu: true,\n    menuContainer: null,\n    fillAttr: \"name\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: function lookup(item) {\n      return item.name;\n    },\n    selectTemplate: function selectTemplate(item) {\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n\n      if (this.range.isContentEditable(this.current.element)) {\n        // Check quill.js\n        if ($(this.current.element).hasClass(\"ql-editor\")) {\n          var editorContainer = $(this.current.element).parent().get(0);\n          var quill = editorContainer.__quill;\n          quill.insertText(cursor - 1, \"#\".concat(item.original.name, \" \"), Quill.sources.API); // cursor position + hashtag length + \"#\" sign + space\n\n          var position = cursor + item.original.name.length + 2;\n          var next = 0;\n\n          if (quill.getLength() > position) {\n            next = position;\n          } else {\n            next = quill.getLength() - 1;\n          } // Workaround https://github.com/quilljs/quill/issues/731\n\n\n          setTimeout(function () {\n            quill.setSelection(next, 0);\n          }, 500);\n          return \"\";\n        }\n\n        return \"<span contenteditable=\\\"false\\\">#\".concat(item.original.name, \"</span>\");\n      }\n\n      return \"#\".concat(item.original.name);\n    },\n    menuItemTemplate: function menuItemTemplate(item) {\n      var tpl = \"<strong>\".concat(item.original.name, \"</strong>\");\n      return tpl;\n    }\n  }); // Tribute needs to be attached to the `.ql-editor` element as said at:\n  // https://github.com/quilljs/quill/issues/1816\n  //\n  // For this reason we need to wait a bit for quill to initialize itself.\n\n  setTimeout(function () {\n    $hashtagContainer.each(function (index, item) {\n      var $qlEditor = $(\".ql-editor\", item);\n\n      if ($qlEditor.length > 0) {\n        tribute.attach($qlEditor);\n      } else {\n        tribute.attach(item);\n      }\n    });\n  }, 1000); // DOM manipulation\n\n  $hashtagContainer.on(\"focusin\", function (event) {\n    // Set the parent container relative to the current element\n    tribute.menuContainer = event.target.parentNode;\n  });\n  $hashtagContainer.on(\"focusout\", function (event) {\n    var $parent = $(event.target).parent();\n\n    if ($parent.hasClass(\"is-active\")) {\n      $parent.removeClass(\"is-active\");\n    }\n  });\n  $hashtagContainer.on(\"input\", function (event) {\n    var $parent = $(event.target).parent();\n\n    if (tribute.isActive) {\n      // We need to move the container to the wrapper selected\n      var $tribute = $(\".tribute-container\");\n      $tribute.appendTo($parent); // Parent adaptation\n\n      $parent.addClass(\"is-active\");\n    } else {\n      $parent.removeClass(\"is-active\");\n    }\n  });\n});","map":{"version":3,"mappings":"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","names":["Tribute","$","$hashtagContainer","nodatafound","attr","noMatchTemplate","cursor","on","event","detail","quill","target","__quill","getText","index","remoteSearch","text","cb","post","query","then","response","data","hashtags","fail","always","$parent","tribute","current","element","parent","addClass","$tribute","find","removeAttr","trigger","values","positionMenu","menuContainer","fillAttr","lookup","item","name","selectTemplate","range","isContentEditable","hasClass","editorContainer","get","insertText","original","Quill","sources","API","position","length","next","getLength","setTimeout","setSelection","menuItemTemplate","tpl","each","$qlEditor","attach","parentNode","removeClass","isActive","appendTo"],"sources":["/home/agustibr/.asdf/installs/ruby/3.0.2/lib/ruby/gems/3.0.0/bundler/gems/decidim-a25b5c74f78d/decidim-core/app/packs/src/decidim/input_hashtags.js"],"sourcesContent":["/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\"\n\n$(() => {\n  const $hashtagContainer = $(\".js-hashtags\");\n  const nodatafound = $hashtagContainer.attr(\"data-noresults\");\n\n  let noMatchTemplate = null\n  if (nodatafound) {\n    noMatchTemplate = () => `<li>${nodatafound}</li>`;\n  }\n\n  // Listener for the event triggered by quilljs\n  let cursor = \"\";\n  $hashtagContainer.on(\"quill-position\", function(event) {\n    if (event.detail !== null) {\n      // When replacing the text content after selecting a hashtag, we only need\n      // to know the hashtag's start position as that is the point which we want\n      // to replace.\n      let quill = event.target.__quill;\n      if (quill.getText(event.detail.index - 1, 1) === \"#\") {\n        cursor = event.detail.index;\n      }\n    }\n  });\n\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n  let remoteSearch = function(text, cb) {\n    $.post(\"/api\", {query: `{hashtags(name:\"${text}\") {name}}`}).\n\n      then((response) => {\n        let data = response.data.hashtags || {};\n        cb(data)\n      }).fail(function() {\n        cb([])\n      }).always(() => {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n        const $parent = $(tribute.current.element).parent()\n        $parent.addClass(\"is-active\")\n\n        // We need to move the container to the wrapper selected\n        const $tribute = $parent.find(\".tribute-container\");\n        // Remove the inline styles, relative to absolute positioning\n        $tribute.removeAttr(\"style\");\n      })\n  };\n\n  // tribute.js docs - http://github.com/zurb/tribute\n  /* global Tribute*/\n  let tribute = new Tribute({\n    trigger: \"#\",\n    values: function (text, cb) {\n      remoteSearch(text, (hashtags) => cb(hashtags));\n    },\n    positionMenu: true,\n    menuContainer: null,\n    fillAttr: \"name\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: (item) => item.name,\n    selectTemplate: function(item) {\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n      if (this.range.isContentEditable(this.current.element)) {\n        // Check quill.js\n        if ($(this.current.element).hasClass(\"ql-editor\")) {\n          let editorContainer = $(this.current.element).parent().get(0);\n          let quill = editorContainer.__quill;\n          quill.insertText(cursor - 1, `#${item.original.name} `, Quill.sources.API);\n          // cursor position + hashtag length + \"#\" sign + space\n          let position = cursor + item.original.name.length + 2;\n\n          let next = 0;\n          if (quill.getLength() > position) {\n            next = position\n          } else {\n            next = quill.getLength() - 1\n          }\n          // Workaround https://github.com/quilljs/quill/issues/731\n          setTimeout(function () {\n            quill.setSelection(next, 0);\n          }, 500);\n\n          return \"\"\n        }\n        return `<span contenteditable=\"false\">#${item.original.name}</span>`;\n      }\n      return `#${item.original.name}`;\n    },\n    menuItemTemplate: function(item) {\n      let tpl = `<strong>${item.original.name}</strong>`;\n      return tpl;\n    }\n  });\n\n  // Tribute needs to be attached to the `.ql-editor` element as said at:\n  // https://github.com/quilljs/quill/issues/1816\n  //\n  // For this reason we need to wait a bit for quill to initialize itself.\n  setTimeout(function() {\n    $hashtagContainer.each((index, item) => {\n      let $qlEditor = $(\".ql-editor\", item);\n      if ($qlEditor.length > 0) {\n        tribute.attach($qlEditor);\n      } else {\n        tribute.attach(item);\n      }\n    });\n  }, 1000);\n\n  // DOM manipulation\n  $hashtagContainer.on(\"focusin\", (event) => {\n    // Set the parent container relative to the current element\n\n    tribute.menuContainer = event.target.parentNode;\n  });\n  $hashtagContainer.on(\"focusout\", (event) => {\n    let $parent = $(event.target).parent();\n\n    if ($parent.hasClass(\"is-active\")) {\n      $parent.removeClass(\"is-active\");\n    }\n  });\n  $hashtagContainer.on(\"input\", (event) => {\n    let $parent = $(event.target).parent();\n\n    if (tribute.isActive) {\n      // We need to move the container to the wrapper selected\n      let $tribute = $(\".tribute-container\");\n      $tribute.appendTo($parent);\n      // Parent adaptation\n      $parent.addClass(\"is-active\");\n    } else {\n      $parent.removeClass(\"is-active\");\n    }\n  });\n});\n"]},"metadata":{},"sourceType":"module"}