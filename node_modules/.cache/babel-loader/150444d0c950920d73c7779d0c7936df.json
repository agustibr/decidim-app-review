{"ast":null,"code":"/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\";\n$(function () {\n  var $mentionContainer = $(\".js-mentions\");\n  var nodatafound = $mentionContainer.attr(\"data-noresults\");\n  var noMatchTemplate = null;\n\n  if (nodatafound) {\n    noMatchTemplate = function noMatchTemplate() {\n      return \"<li>\".concat(nodatafound, \"</li>\");\n    };\n  } // Listener for the event triggered by quilljs\n\n\n  var cursor = \"\";\n  $mentionContainer.on(\"quill-position\", function (event) {\n    if (event.detail !== null) {\n      // When replacing the text content after selecting a hashtag, we only need\n      // to know the hashtag's start position as that is the point which we want\n      // to replace.\n      var quill = event.target.__quill;\n\n      if (quill.getText(event.detail.index - 1, 1) === \"@\") {\n        cursor = event.detail.index;\n      }\n    }\n  }); // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds\n\n  /* eslint no-invalid-this: 0 */\n\n  /* eslint consistent-this: 0 */\n\n  /* eslint prefer-reflect: 0 */\n\n  var debounce = function debounce(callback, wait) {\n    var _this = this;\n\n    var timeout = null;\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      var context = _this;\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        return callback.apply(context, args);\n      }, wait);\n    };\n  };\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n\n\n  var remoteSearch = function remoteSearch(text, cb) {\n    var query = \"{users(filter:{wildcard:\\\"\".concat(text, \"\\\"}){nickname,name,avatarUrl,__typename,...on UserGroup{membersCount}}}\");\n    $.post(\"/api\", {\n      query: query\n    }).then(function (response) {\n      var data = response.data.users || {};\n      cb(data);\n    }).fail(function () {\n      cb([]);\n    }).always(function () {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n      var $parent = $(tribute.current.element).parent();\n      $parent.addClass(\"is-active\"); // We need to move the container to the wrapper selected\n\n      var $tribute = $parent.find(\".tribute-container\"); // Remove the inline styles, relative to absolute positioning\n\n      $tribute.removeAttr(\"style\");\n    });\n  }; // tribute.js docs - http://github.com/zurb/tribute\n\n  /* global Tribute*/\n\n\n  var tribute = new Tribute({\n    trigger: \"@\",\n    // avoid overloading the API if the user types too fast\n    values: debounce(function (text, cb) {\n      remoteSearch(text, function (users) {\n        return cb(users);\n      });\n    }, 250),\n    positionMenu: true,\n    menuContainer: null,\n    allowSpaces: true,\n    menuItemLimit: 5,\n    fillAttr: \"nickname\",\n    selectClass: \"highlight\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: function lookup(item) {\n      return item.nickname + item.name;\n    },\n    selectTemplate: function selectTemplate(item) {\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n\n      if (this.range.isContentEditable(this.current.element)) {\n        // Check quill.js\n        if ($(this.current.element).hasClass(\"ql-editor\")) {\n          var editorContainer = $(this.current.element).parent().get(0);\n          var quill = editorContainer.__quill;\n          quill.insertText(cursor - 1, \"\".concat(item.original.nickname, \" \"), Quill.sources.API); // cursor position + nickname length + \"@\" sign + space\n\n          var position = cursor + item.original.nickname.length + 2;\n          var next = 0;\n\n          if (quill.getLength() > position) {\n            next = position;\n          } else {\n            next = quill.getLength() - 1;\n          } // Workaround https://github.com/quilljs/quill/issues/731\n\n\n          setTimeout(function () {\n            quill.setSelection(next, 0);\n          }, 500);\n          return \"\";\n        }\n\n        return \"<span contenteditable=\\\"false\\\">\".concat(item.original.nickname, \"</span>\");\n      }\n\n      return item.original.nickname;\n    },\n    menuItemTemplate: function menuItemTemplate(item) {\n      var svg = \"\";\n\n      if (window.Decidim && item.original.__typename === \"UserGroup\") {\n        var iconsPath = window.Decidim.config.get(\"icons_path\");\n        svg = \"<span class=\\\"is-group\\\">\".concat(item.original.membersCount, \"x <svg class=\\\"icon--members icon\\\"><use href=\\\"\").concat(iconsPath, \"#icon-members\\\"/></svg></span>\");\n      }\n\n      return \"<div class=\\\"tribute-item \".concat(item.original.__typename, \"\\\">\\n      <span class=\\\"author__avatar\\\"><img src=\\\"\").concat(item.original.avatarUrl, \"\\\" alt=\\\"author-avatar\\\"></span>\\n        <strong>\").concat(item.original.nickname, \"</strong>\\n        <small>\").concat(item.original.name, \"</small>\\n        \").concat(svg, \"\\n      </div>\");\n    }\n  });\n\n  var setupEvents = function setupEvents($element) {\n    // DOM manipulation\n    $element.on(\"focusin\", function (event) {\n      // Set the parent container relative to the current element\n      tribute.menuContainer = event.target.parentNode;\n    });\n    $element.on(\"focusout\", function (event) {\n      var $parent = $(event.target).parent();\n\n      if ($parent.hasClass(\"is-active\")) {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n    $element.on(\"input\", function (event) {\n      var $parent = $(event.target).parent();\n\n      if (tribute.isActive) {\n        // We need to move the container to the wrapper selected\n        var $tribute = $(\".tribute-container\");\n        $tribute.appendTo($parent); // Parent adaptation\n\n        $parent.addClass(\"is-active\");\n      } else {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n  };\n\n  setupEvents($mentionContainer); // This allows external libraries (like React) to use the component\n  // by simply firing and event targeting the element where to attach Tribute\n\n  $(document).on(\"attach-mentions-element\", function (event, element) {\n    if (!element) {\n      return;\n    }\n\n    tribute.attach(element); // Due a bug in Tribute, re-add menu to DOM if it has been removed\n    // See https://github.com/zurb/tribute/issues/140\n\n    if (tribute.menu && !document.body.contains(tribute.menu)) {\n      tribute.range.getDocument().body.appendChild(tribute.menu);\n    }\n\n    setupEvents($(element));\n  }); // tribute.attach($mentionContainer);\n  // Tribute needs to be attached to the `.ql-editor` element as said at:\n  // https://github.com/quilljs/quill/issues/1816\n  //\n  // For this reason we need to wait a bit for quill to initialize itself.\n\n  setTimeout(function () {\n    $mentionContainer.each(function (index, item) {\n      var $qlEditor = $(\".ql-editor\", item);\n\n      if ($qlEditor.length > 0) {\n        tribute.attach($qlEditor);\n      } else {\n        tribute.attach(item);\n      }\n    });\n  }, 1000);\n});","map":{"version":3,"mappings":"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","names":["Tribute","$","$mentionContainer","nodatafound","attr","noMatchTemplate","cursor","on","event","detail","quill","target","__quill","getText","index","debounce","callback","wait","timeout","args","arguments","context","_this","clearTimeout","setTimeout","apply","remoteSearch","text","cb","query","post","then","response","data","users","fail","always","$parent","tribute","current","element","parent","addClass","$tribute","find","removeAttr","trigger","values","positionMenu","menuContainer","allowSpaces","menuItemLimit","fillAttr","selectClass","lookup","item","nickname","name","selectTemplate","range","isContentEditable","hasClass","editorContainer","get","insertText","original","Quill","sources","API","position","length","next","getLength","setSelection","menuItemTemplate","svg","window","Decidim","__typename","iconsPath","config","membersCount","avatarUrl","setupEvents","$element","parentNode","removeClass","isActive","appendTo","document","attach","menu","body","contains","getDocument","appendChild","each","$qlEditor"],"sources":["/home/agustibr/.asdf/installs/ruby/3.0.2/lib/ruby/gems/3.0.0/bundler/gems/decidim-a25b5c74f78d/decidim-core/app/packs/src/decidim/input_mentions.js"],"sourcesContent":["/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\"\n\n$(() => {\n  const $mentionContainer = $(\".js-mentions\");\n  const nodatafound = $mentionContainer.attr(\"data-noresults\");\n\n  let noMatchTemplate = null\n  if (nodatafound) {\n    noMatchTemplate = () => `<li>${nodatafound}</li>`;\n  }\n\n  // Listener for the event triggered by quilljs\n  let cursor = \"\";\n  $mentionContainer.on(\"quill-position\", (event) => {\n    if (event.detail !== null) {\n      // When replacing the text content after selecting a hashtag, we only need\n      // to know the hashtag's start position as that is the point which we want\n      // to replace.\n      let quill = event.target.__quill;\n      if (quill.getText(event.detail.index - 1, 1) === \"@\") {\n        cursor = event.detail.index;\n      }\n    }\n  });\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds\n  /* eslint no-invalid-this: 0 */\n  /* eslint consistent-this: 0 */\n  /* eslint prefer-reflect: 0 */\n  const debounce = function(callback, wait) {\n    let timeout = null;\n    return (...args) => {\n      const context = this;\n      clearTimeout(timeout);\n      timeout = setTimeout(() => callback.apply(context, args), wait);\n    };\n  }\n\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n  let remoteSearch = function(text, cb) {\n    let query = `{users(filter:{wildcard:\"${text}\"}){nickname,name,avatarUrl,__typename,...on UserGroup{membersCount}}}`;\n    $.post(\"/api\", {query: query}).\n      then((response) => {\n        let data = response.data.users || {};\n        cb(data)\n      }).fail(function() {\n        cb([])\n      }).always(() => {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n        const $parent = $(tribute.current.element).parent();\n        $parent.addClass(\"is-active\");\n\n        // We need to move the container to the wrapper selected\n        const $tribute = $parent.find(\".tribute-container\");\n        // Remove the inline styles, relative to absolute positioning\n        $tribute.removeAttr(\"style\");\n      })\n  };\n\n  // tribute.js docs - http://github.com/zurb/tribute\n  /* global Tribute*/\n  let tribute = new Tribute({\n    trigger: \"@\",\n    // avoid overloading the API if the user types too fast\n    values: debounce(function (text, cb) {\n      remoteSearch(text, (users) => cb(users));\n    }, 250),\n    positionMenu: true,\n    menuContainer: null,\n    allowSpaces: true,\n    menuItemLimit: 5,\n    fillAttr: \"nickname\",\n    selectClass: \"highlight\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: (item) => item.nickname + item.name,\n    selectTemplate: function(item) {\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n      if (this.range.isContentEditable(this.current.element)) {\n        // Check quill.js\n        if ($(this.current.element).hasClass(\"ql-editor\")) {\n          let editorContainer = $(this.current.element).parent().get(0);\n          let quill = editorContainer.__quill;\n          quill.insertText(cursor - 1, `${item.original.nickname} `, Quill.sources.API);\n          // cursor position + nickname length + \"@\" sign + space\n          let position = cursor + item.original.nickname.length + 2\n\n          let next = 0;\n          if (quill.getLength() > position) {\n            next = position\n          } else {\n            next = quill.getLength() - 1\n          }\n          // Workaround https://github.com/quilljs/quill/issues/731\n          setTimeout(function () {\n            quill.setSelection(next, 0);\n          }, 500);\n\n          return \"\"\n        }\n        return `<span contenteditable=\"false\">${item.original.nickname}</span>`;\n      }\n      return item.original.nickname;\n    },\n    menuItemTemplate: function(item) {\n      let svg = \"\";\n      if (window.Decidim && item.original.__typename === \"UserGroup\") {\n        const iconsPath =  window.Decidim.config.get(\"icons_path\");\n\n        svg = `<span class=\"is-group\">${item.original.membersCount}x <svg class=\"icon--members icon\"><use href=\"${iconsPath}#icon-members\"/></svg></span>`;\n      }\n      return `<div class=\"tribute-item ${item.original.__typename}\">\n      <span class=\"author__avatar\"><img src=\"${item.original.avatarUrl}\" alt=\"author-avatar\"></span>\n        <strong>${item.original.nickname}</strong>\n        <small>${item.original.name}</small>\n        ${svg}\n      </div>`;\n    }\n  });\n\n  let setupEvents = function($element) {\n    // DOM manipulation\n    $element.on(\"focusin\", (event) => {\n      // Set the parent container relative to the current element\n      tribute.menuContainer = event.target.parentNode;\n    });\n    $element.on(\"focusout\", (event) => {\n      let $parent = $(event.target).parent();\n\n      if ($parent.hasClass(\"is-active\")) {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n    $element.on(\"input\", (event) => {\n      let $parent = $(event.target).parent();\n\n      if (tribute.isActive) {\n        // We need to move the container to the wrapper selected\n        let $tribute = $(\".tribute-container\");\n        $tribute.appendTo($parent);\n\n        // Parent adaptation\n        $parent.addClass(\"is-active\");\n      } else {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n  };\n\n  setupEvents($mentionContainer);\n\n  // This allows external libraries (like React) to use the component\n  // by simply firing and event targeting the element where to attach Tribute\n  $(document).on(\"attach-mentions-element\", (event, element) => {\n    if (!element) {\n      return;\n    }\n    tribute.attach(element);\n    // Due a bug in Tribute, re-add menu to DOM if it has been removed\n    // See https://github.com/zurb/tribute/issues/140\n    if (tribute.menu && !document.body.contains(tribute.menu)) {\n      tribute.range.getDocument().body.appendChild(tribute.menu);\n    }\n    setupEvents($(element));\n  });\n\n  // tribute.attach($mentionContainer);\n  // Tribute needs to be attached to the `.ql-editor` element as said at:\n  // https://github.com/quilljs/quill/issues/1816\n  //\n  // For this reason we need to wait a bit for quill to initialize itself.\n  setTimeout(function() {\n    $mentionContainer.each((index, item) => {\n      let $qlEditor = $(\".ql-editor\", item);\n      if ($qlEditor.length > 0) {\n        tribute.attach($qlEditor);\n      } else {\n        tribute.attach(item);\n      }\n    });\n  }, 1000);\n});\n\n"]},"metadata":{},"sourceType":"module"}